spring.application.name=backend

# Database Configuration - LOCALHOST for local development
spring.datasource.url=jdbc:postgresql://localhost:5432/elguindyDB
spring.datasource.username=postgres
spring.datasource.password=1234
spring.datasource.driver-class-name=org.postgresql.Driver
spring.docker.compose.enabled=false

# JPA & Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.generate-ddl=true
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# Development settings to handle schema issues
spring.jpa.properties.hibernate.hbm2ddl.auto=update
spring.jpa.properties.hibernate.hbm2ddl.halt_on_error=false
spring.jpa.properties.hibernate.hbm2ddl.drop_unknown_tables=false

# Disable foreign key validation during development (use with caution)
spring.jpa.properties.hibernate.hbm2ddl.import_files_sql_extractor=org.hibernate.tool.schema.internal.script.MultiLineSqlScriptExtractor

# Transaction Configuration
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

spring.security.user.name=admin
spring.security.user.password=admin
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# AWS S3 Configuration - Replace MinIO
aws.s3.bucket-name=elguindy
aws.s3.region=us-east-1
aws.s3.enabled=true
# Optional: Custom S3 endpoint URL (leave empty for standard AWS S3)
aws.s3.public-url=http://localhost:9000

# Legacy MinIO Configuration - Keep for backward compatibility during migration
# You can remove these after migration is complete
minio.endpoint=http://localhost:9000
minio.publicUrl=http://localhost:9000
minio.accessKey=minioadmin
minio.secretKey=minioadmin
minio.bucketName=elguindy
minio.enabled=true

# Storage Configuration
storage.type=minio

# Enable multipart uploads
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.file-size-threshold=2KB

# Management endpoints for health check
management.endpoints.web.exposure.include=health,metrics,info
management.endpoint.health.show-details=always
management.endpoint.metrics.enabled=true
management.metrics.export.prometheus.enabled=true

# Print Job Configuration
app.print-jobs.max-retry-attempts=3
app.print-jobs.retry-delay-seconds=30
app.print-jobs.fail-invoice-on-all-print-job-failures=false
app.print-jobs.notify-on-partial-failures=true
app.print-jobs.pdf-generation-timeout-seconds=60
app.print-jobs.pdf-storage-directory=/app/pdfs
app.print-jobs.max-pdf-size-mb=10
app.print-jobs.cleanup-old-pdfs=true
app.print-jobs.pdf-retention-days=30

# Cutting Rate Configuration
app.cutting-rates.enable-overlap-detection=true
app.cutting-rates.auto-fix-overlaps=false
app.cutting-rates.default-shatf-rate=10.0
app.cutting-rates.default-laser-rate=50.0

# Invoice Configuration
app.invoice.max-glass-width=5000.0
app.invoice.max-glass-height=3000.0
app.invoice.allow-partial-line-failures=true
app.invoice.auto-retry-failed-operations=true

# WebSocket Configuration
app.websocket.enabled=true
app.websocket.heartbeat-interval=30000
app.websocket.max-session-idle-timeout=300000

# Error Handling Configuration
app.error-handling.include-stack-trace=false
app.error-handling.include-debug-info=true
app.error-handling.default-error-message=??? ??? ??? ?????
app.error-handling.send-error-notifications=true

# Monitoring Configuration
app.monitoring.print-job-check-interval=300000
app.monitoring.system-health-check-interval=60000
app.monitoring.alert-on-high-pending-jobs=true
app.monitoring.max-pending-jobs-threshold=100

# Logging Configuration
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.com.example.backend=DEBUG
logging.level.com.example.backend.services.InvoiceService=INFO
logging.level.com.example.backend.services.PrintJobService=INFO
logging.level.com.example.backend.services.cutting=DEBUG
logging.level.com.example.backend.exceptions=WARN

# Separate log files for different components
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Log file configuration
logging.file.name=logs/elguindy-backend.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# JWT Configuration
jwt.secret=${JWT_SECRET:633292096cab01eb8f5100d1f3e0bcb0e0e704b2ab78d2706c4650ea3cfd586e863a33ea7318ee7d851682618ec773060a2ba86deb7490dc84e32bd10112a29d713ba96acbf2ad2a61480a99f3c4999be4f40fbc0dde04bb13cf9c9c84a6084abeb15677bca2d440778d3eaabbae1f42640a16d5913865559fb5e6d2d65f851cfe9c39e78f5fd26b1cdc5d04a27188779928161375af1f74acdd6b80749d1983f4c2aa8bacbb5cf7d67f7f0c52cda907a60c735e32a2d53e4f506821e8cb6e83059890b178a9e5b2e06acc040064c4697e4685d7a0c1bf521ff2a437469234fabb03fd884292606b604afcd0337a0805e32a7ad8c335f5d8ba51c2b1e300ca84ae6f5b8366c890cf662449d41d7e64b2437cd506e9123e0fa73b0a1f53d7619c}
jwt.expiration=${JWT_EXPIRATION:86400000}

# Internationalization
spring.messages.basename=messages
spring.messages.encoding=UTF-8
spring.messages.fallback-to-system-locale=false

# CORS Configuration
app.cors.allowed-origins=http://localhost:3000,http://localhost:5173
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# Async Configuration
spring.task.execution.pool.core-size=8
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=elguindy-async-

# Scheduler Configuration
spring.task.scheduling.pool.size=5
spring.task.scheduling.thread-name-prefix=elguindy-scheduler-

# Cache Configuration
spring.cache.type=simple
spring.cache.cache-names=cutting-rates,glass-types,customers

# Validation Configuration
spring.validation.enabled=true

